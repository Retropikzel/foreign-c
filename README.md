# Portable Foreign Function Interface for R7RS schemes

Foreign function interface that is supported on multiple R7RS Sceheme implementations.

Note that this software is in **alpha** stage. That said the interface should not be changing anymore.

Any help in form of constructive advice and bug reports are appreciated.

[Documentation](https://retropikzel.neocities.org/r7rs-pffi/) or run mkdocs serve or see docs/.

[Issue tracker](https://todo.sr.ht/~retropikzel/r7rs-pffi)

[Maling lists](https://sr.ht/~retropikzel/r7rs-pffi/lists)


For documentation see [retropikzel.neocities.org/r7rs-pffi](retropikzel.neocities.org/r7rs-pffi)
or run mkdocs serve or see or docs/ directory.

For status of what tests pass on which implementations see
[Jenkins](https://jenkins.staging.scheme.org/job/r7rs-pffi/job/master/).

# Goals

- Support only R7RS implementations (for now)
- Same interface on all implementations
  - Some things that are procedures on one implementation are macros on other,
  but they must behave the same

# Non goals

- To have every possible FFI feature
- Compiling of C code at any point
    - That is no stubs, no C code generated by the library and so on

# Support tiers

Support is defined in tiers, each tier has short explanation about it after the title.

Currently the interface of the library is okay. Now work needs to be done to make tests and see
that each implementation passes those tests. This will be done in tiered order starting from tier 1.

Untiered, support needs to be investigated:

- [Gerbil](https://cons.io/)
- [Ypsilon](http://www.littlewingpinball.com/doc/en/ypsilon/)
- [Larceny](https://larcenists.org/)
- [Mosh](https://mosh.monaos.org)
- [Skint](https://github.com/false-schemers/skint)
- [s7](https://scheme.fail://ccrma.stanford.edu/software/snd/snd/s7.html)

## Tier 1

Aiming to support these first

- [Chicken](https://www.call-cc.org/)
- [Guile](https://www.gnu.org/software/guile/)
- [Kawa](https://www.gnu.org/software/kawa/index.html)
    - Needs at least java version 22
    - Needs jvm flags:
        - --add-exports java.base/jdk.internal.foreign.abi=ALL-UNNAMED
        - --add-exports java.base/jdk.internal.foreign.layout=ALL-UNNAMED
        - --add-exports java.base/jdk.internal.foreign=ALL-UNNAMED
        - --enable-native-access=ALL-UNNAMED
- [Sagittarius](https://bitbucket.org/ktakashi/sagittarius-scheme/wiki/Home)
- [Racket](https://racket-lang.org/)

## Tier 2

Work in progress

- [Gambit](https://gambitscheme.org)
    - Propably able to support everything but so annoying to deal with that it's currently in tier 2
- [STKlos](https://stklos.net/)
    - No callback support
- [Cyclone](https://justinethier.github.io/cyclone/)
    - No callback support

## Tier 3

In queue

- [LIPS](https://lips.js.org/)
    - Will work on nodejs by using some Javascript FFI
    - Javascript side needs design
- [Biwascheme](https://www.biwascheme.org/)
    - Will work on nodejs by using some Javascript FFI
    - Javascript side needs design

## Tier 4

Support needs investigation and serious design or making dynamic FFI for the implementation

- [Chibi](https://synthcode.com/scheme/chibi)
    - FFI requires C code
- [MIT-Scheme](https://www.gnu.org/software/mit-scheme/)
    - FFI requires C code
- [tr7](https://gitlab.com/jobol/tr7)
    - FFI requires C code
- [Gauche](https://practical-scheme.net/gauche/)
    - FFI requires C code

## Tier 5

Support maybe possible/dreaming about.

- [Airship](https://gitlab.com/mbabich/airship-scheme)
- [Other gambit targets](https://gambitscheme.org/)
  - Gambit compiles to different targets other than C too, for example Javascript. It would be cool
  and interesting to see if this FFI could also support some of those

## Tier 6

Other.

- [Loko](https://scheme.fail/)
    - Desires no C interop, I can respect that
