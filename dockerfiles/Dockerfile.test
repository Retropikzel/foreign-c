ARG SCHEME=chibi
ARG IMAGE=chibi:head
FROM docker.io/schemers/${IMAGE}
RUN apt-get update && apt-get install \
    --no-install-suggests \
    --no-install-recommends \
    -y \
    gcc \
    libc6-dev \
    make \
    libffi-dev \
    pandoc \
    libmbedtls-dev \
    tree \
    git \
    ca-certificates
RUN mkdir -p ${HOME}/.snow && echo "()" > ${HOME}/.snow/config.scm
#RUN git clone https://github.com/ashinn/chibi-scheme.git --depth=1
RUN git clone https://github.com/Retropikzel/chibi-scheme.git --branch gauche-fixes
RUN cd chibi-scheme && make && make install
COPY --from=docker.io/retropikzel1/compile-r7rs /opt/compile-r7rs /opt/compile-r7rs
ENV PATH=/opt/compile-r7rs/bin:${PATH}
ARG SCHEME=chibi
ENV COMPILE_R7RS=${SCHEME}
ENV GUILE_AUTO_COMPILE=0
