ARG SCHEME=chibi
ARG IMAGE=chibi:head
FROM schemers/${IMAGE}
FROM debian:trixie AS build
WORKDIR /debs
RUN apt-get update && apt-get install \
    -y \
    --no-install-recommends \
    --no-install-suggests \
    --download-only \
    gcc libffi-dev libc-dev cmark make linux-libc-dev

ARG SCHEME=chibi
ARG IMAGE=chibi:head
FROM schemers/${IMAGE}
COPY --from=build /var/cache/apt/archives/*.deb /debs/
RUN dpkg -i /debs/*.deb
COPY --from=retropikzel1/compile-r7rs /opt/compile-r7rs /opt/compile-r7rs
ENV PATH=${PATH}:/opt/compile-r7rs/bin:/build/usr/bin
ARG SCHEME=chibi
ENV COMPILE_R7RS=${SCHEME}
ENV GUILE_AUTO_COMPILE=0
RUN mkdir -p ${HOME}/.snow && echo "()" > ${HOME}/.snow/config.scm

